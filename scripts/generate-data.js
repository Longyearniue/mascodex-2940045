#!/usr/bin/env node
/**
 * generate-data.js
 *
 * Generates static JSON data files for the Amoeba City game:
 *   - data/prefectures.json   (47 Japanese prefectures)
 *   - data/districts.json     (3-digit postal code prefix → district info)
 *   - data/adjacency.json     (3-digit postal code prefix → adjacent prefixes)
 *
 * Deterministic: produces identical output on every run.
 */

const fs = require("fs");
const path = require("path");

// ---------------------------------------------------------------------------
// 1. Prefecture definitions
// ---------------------------------------------------------------------------

const PREFECTURES = [
  { code: "01", name: "北海道",   nameEn: "Hokkaido",  region: "hokkaido",  element: "water",   population: 5220000,  ranges: [[1,9],[40,49],[50,59],[60,69],[70,79],[80,89],[90,99]] },
  { code: "02", name: "青森県",   nameEn: "Aomori",    region: "tohoku",    element: "water",   population: 1230000,  ranges: [[30,39]] },
  { code: "03", name: "岩手県",   nameEn: "Iwate",     region: "tohoku",    element: "water",   population: 1210000,  ranges: [[20,29]] },
  { code: "04", name: "宮城県",   nameEn: "Miyagi",    region: "tohoku",    element: "water",   population: 2300000,  ranges: [[980,989]] },
  { code: "05", name: "秋田県",   nameEn: "Akita",     region: "tohoku",    element: "water",   population: 960000,   ranges: [[10,19]] },
  { code: "06", name: "山形県",   nameEn: "Yamagata",  region: "tohoku",    element: "water",   population: 1070000,  ranges: [[990,999]] },
  { code: "07", name: "福島県",   nameEn: "Fukushima", region: "tohoku",    element: "water",   population: 1830000,  ranges: [[960,979]] },
  { code: "08", name: "茨城県",   nameEn: "Ibaraki",   region: "kanto",     element: "thunder", population: 2870000,  ranges: [[300,319]] },
  { code: "09", name: "栃木県",   nameEn: "Tochigi",   region: "kanto",     element: "thunder", population: 1930000,  ranges: [[320,329]] },
  { code: "10", name: "群馬県",   nameEn: "Gunma",     region: "kanto",     element: "thunder", population: 1940000,  ranges: [[370,379]] },
  { code: "11", name: "埼玉県",   nameEn: "Saitama",   region: "kanto",     element: "thunder", population: 7340000,  ranges: [[330,369]] },
  { code: "12", name: "千葉県",   nameEn: "Chiba",     region: "kanto",     element: "thunder", population: 6280000,  ranges: [[260,299]] },
  { code: "13", name: "東京都",   nameEn: "Tokyo",     region: "kanto",     element: "thunder", population: 14000000, ranges: [[100,208]] },
  { code: "14", name: "神奈川県", nameEn: "Kanagawa",  region: "kanto",     element: "thunder", population: 9240000,  ranges: [[210,259]] },
  { code: "15", name: "新潟県",   nameEn: "Niigata",   region: "chubu",     element: "earth",   population: 2200000,  ranges: [[940,959]] },
  { code: "16", name: "富山県",   nameEn: "Toyama",    region: "chubu",     element: "earth",   population: 1040000,  ranges: [[930,939]] },
  { code: "17", name: "石川県",   nameEn: "Ishikawa",  region: "chubu",     element: "earth",   population: 1130000,  ranges: [[920,929]] },
  { code: "18", name: "福井県",   nameEn: "Fukui",     region: "chubu",     element: "earth",   population: 770000,   ranges: [[910,919]] },
  { code: "19", name: "山梨県",   nameEn: "Yamanashi", region: "chubu",     element: "earth",   population: 810000,   ranges: [[400,409]] },
  { code: "20", name: "長野県",   nameEn: "Nagano",    region: "chubu",     element: "earth",   population: 2050000,  ranges: [[380,399]] },
  { code: "21", name: "岐阜県",   nameEn: "Gifu",      region: "chubu",     element: "earth",   population: 1980000,  ranges: [[500,509]] },
  { code: "22", name: "静岡県",   nameEn: "Shizuoka",  region: "chubu",     element: "earth",   population: 3630000,  ranges: [[410,439]] },
  { code: "23", name: "愛知県",   nameEn: "Aichi",     region: "chubu",     element: "earth",   population: 7540000,  ranges: [[440,498]] },
  { code: "24", name: "三重県",   nameEn: "Mie",       region: "kansai",    element: "fire",    population: 1780000,  ranges: [[510,519]] },
  { code: "25", name: "滋賀県",   nameEn: "Shiga",     region: "kansai",    element: "fire",    population: 1410000,  ranges: [[520,529]] },
  { code: "26", name: "京都府",   nameEn: "Kyoto",     region: "kansai",    element: "fire",    population: 2580000,  ranges: [[600,629]] },
  { code: "27", name: "大阪府",   nameEn: "Osaka",     region: "kansai",    element: "fire",    population: 8840000,  ranges: [[530,599]] },
  { code: "28", name: "兵庫県",   nameEn: "Hyogo",     region: "kansai",    element: "fire",    population: 5470000,  ranges: [[650,679]] },
  { code: "29", name: "奈良県",   nameEn: "Nara",      region: "kansai",    element: "fire",    population: 1330000,  ranges: [[630,639]] },
  { code: "30", name: "和歌山県", nameEn: "Wakayama",  region: "kansai",    element: "fire",    population: 920000,   ranges: [[640,649]] },
  { code: "31", name: "鳥取県",   nameEn: "Tottori",   region: "chugoku",   element: "wood",    population: 550000,   ranges: [[680,689]] },
  { code: "32", name: "島根県",   nameEn: "Shimane",   region: "chugoku",   element: "wood",    population: 670000,   ranges: [[690,699]] },
  { code: "33", name: "岡山県",   nameEn: "Okayama",   region: "chugoku",   element: "wood",    population: 1890000,  ranges: [[700,719]] },
  { code: "34", name: "広島県",   nameEn: "Hiroshima", region: "chugoku",   element: "wood",    population: 2800000,  ranges: [[720,739]] },
  { code: "35", name: "山口県",   nameEn: "Yamaguchi", region: "chugoku",   element: "wood",    population: 1340000,  ranges: [[740,759]] },
  { code: "36", name: "徳島県",   nameEn: "Tokushima", region: "shikoku",   element: "wood",    population: 720000,   ranges: [[770,779]] },
  { code: "37", name: "香川県",   nameEn: "Kagawa",    region: "shikoku",   element: "wood",    population: 950000,   ranges: [[760,769]] },
  { code: "38", name: "愛媛県",   nameEn: "Ehime",     region: "shikoku",   element: "wood",    population: 1340000,  ranges: [[790,799]] },
  { code: "39", name: "高知県",   nameEn: "Kochi",     region: "shikoku",   element: "wood",    population: 690000,   ranges: [[780,789]] },
  { code: "40", name: "福岡県",   nameEn: "Fukuoka",   region: "kyushu",    element: "fire",    population: 5140000,  ranges: [[800,839]] },
  { code: "41", name: "佐賀県",   nameEn: "Saga",      region: "kyushu",    element: "fire",    population: 810000,   ranges: [[840,849]] },
  { code: "42", name: "長崎県",   nameEn: "Nagasaki",  region: "kyushu",    element: "fire",    population: 1310000,  ranges: [[850,859]] },
  { code: "43", name: "熊本県",   nameEn: "Kumamoto",  region: "kyushu",    element: "fire",    population: 1740000,  ranges: [[860,869]] },
  { code: "44", name: "大分県",   nameEn: "Oita",      region: "kyushu",    element: "fire",    population: 1120000,  ranges: [[870,879]] },
  { code: "45", name: "宮崎県",   nameEn: "Miyazaki",  region: "kyushu",    element: "fire",    population: 1070000,  ranges: [[880,889]] },
  { code: "46", name: "鹿児島県", nameEn: "Kagoshima", region: "kyushu",    element: "fire",    population: 1590000,  ranges: [[890,899]] },
  { code: "47", name: "沖縄県",   nameEn: "Okinawa",   region: "okinawa",   element: "fire",    population: 1460000,  ranges: [[900,907]] },
];

// ---------------------------------------------------------------------------
// 2. District name hints (representative area names for each postal prefix)
//    We use a compact lookup for notable prefixes. For unlisted ones we derive
//    a generic name from the prefecture.
// ---------------------------------------------------------------------------

const DISTRICT_NAMES = {
  // 北海道
  "001": "札幌市北区", "002": "札幌市北区篠路", "003": "札幌市白石区", "004": "札幌市厚別区",
  "005": "札幌市南区", "006": "札幌市手稲区", "007": "札幌市北区太平",
  "008": "札幌市中央区", "009": "札幌市清田区",
  "010": "秋田市", "011": "秋田市南部", "012": "湯沢市", "013": "横手市",
  "014": "大仙市", "015": "由利本荘市", "016": "能代市", "017": "大館市",
  "018": "にかほ市周辺", "019": "秋田市河辺",
  "020": "盛岡市", "021": "盛岡市南部", "022": "大船渡市", "023": "奥州市",
  "024": "北上市", "025": "花巻市", "026": "釜石市", "027": "一関市",
  "028": "岩手郡", "029": "一関市周辺",
  "030": "青森市", "031": "八戸市", "032": "十和田市周辺", "033": "三沢市",
  "034": "十和田市", "035": "むつ市", "036": "弘前市", "037": "五所川原市",
  "038": "南津軽郡", "039": "三戸郡",
  "040": "函館市", "041": "函館市周辺", "042": "函館市西部", "043": "檜山郡",
  "044": "虻田郡", "045": "岩内郡", "046": "余市郡", "047": "小樽市",
  "048": "余市郡周辺", "049": "虻田郡北部",
  "050": "室蘭市", "051": "室蘭市周辺", "052": "伊達市", "053": "苫小牧市",
  "054": "勇払郡", "055": "沙流郡", "056": "浦河郡", "057": "浦河町周辺",
  "058": "幌泉郡", "059": "日高郡",
  "060": "札幌市中央区", "061": "札幌市周辺", "062": "札幌市豊平区", "063": "札幌市西区",
  "064": "札幌市中央区南", "065": "札幌市東区", "066": "千歳市", "067": "江別市",
  "068": "岩見沢市", "069": "江別市周辺",
  "070": "旭川市", "071": "旭川市周辺", "072": "美唄市", "073": "滝川市",
  "074": "深川市", "075": "芦別市", "076": "富良野市", "077": "留萌市",
  "078": "旭川市東部", "079": "上川郡",
  "080": "帯広市", "081": "帯広市周辺", "082": "河西郡", "083": "中川郡",
  "084": "釧路市", "085": "釧路市周辺", "086": "釧路郡", "087": "根室市",
  "088": "釧路町", "089": "中川郡周辺",
  "090": "北見市", "091": "北見市周辺", "092": "網走郡", "093": "網走市",
  "094": "紋別市", "095": "士別市", "096": "名寄市", "097": "稚内市",
  "098": "天塩郡", "099": "紋別郡",

  // 東京都 100-208
  "100": "千代田区", "101": "千代田区神田", "102": "千代田区麹町", "103": "中央区日本橋",
  "104": "中央区銀座", "105": "港区新橋", "106": "港区六本木", "107": "港区赤坂",
  "108": "港区高輪", "109": "港区", "110": "台東区", "111": "台東区浅草",
  "112": "文京区", "113": "文京区本郷", "114": "北区", "115": "北区赤羽",
  "116": "荒川区", "117": "北区周辺", "118": "北区王子",
  "119": "板橋区周辺",
  "120": "足立区", "121": "足立区西部", "122": "葛飾区", "123": "葛飾区西部",
  "124": "葛飾区東部", "125": "葛飾区北部", "126": "江戸川区北部", "127": "足立区北部",
  "128": "江戸川区南部", "129": "足立区東部",
  "130": "墨田区", "131": "墨田区東部", "132": "江戸川区", "133": "江戸川区西部",
  "134": "江戸川区中部", "135": "江東区", "136": "江東区南部", "137": "江東区東部",
  "138": "墨田区周辺", "139": "江戸川区周辺",
  "140": "品川区", "141": "品川区南部", "142": "品川区西部", "143": "大田区",
  "144": "大田区南部", "145": "大田区西部", "146": "大田区東部", "147": "大田区北部",
  "148": "大田区中部", "149": "大田区周辺",
  "150": "渋谷区", "151": "渋谷区代々木", "152": "目黒区", "153": "目黒区南部",
  "154": "世田谷区", "155": "世田谷区北部", "156": "世田谷区南部", "157": "世田谷区西部",
  "158": "世田谷区東部", "159": "世田谷区周辺",
  "160": "新宿区", "161": "新宿区北部", "162": "新宿区西部", "163": "新宿区西新宿",
  "164": "中野区", "165": "中野区南部", "166": "杉並区", "167": "杉並区北部",
  "168": "杉並区南部", "169": "新宿区高田馬場",
  "170": "豊島区", "171": "豊島区南部", "172": "板橋区", "173": "板橋区北部",
  "174": "板橋区東部", "175": "板橋区西部", "176": "練馬区", "177": "練馬区西部",
  "178": "練馬区北部", "179": "練馬区東部",
  "180": "武蔵野市", "181": "三鷹市", "182": "調布市", "183": "府中市",
  "184": "小金井市", "185": "国分寺市", "186": "国立市", "187": "小平市",
  "188": "西東京市", "189": "東村山市",
  "190": "立川市", "191": "日野市", "192": "八王子市", "193": "八王子市西部",
  "194": "町田市", "195": "町田市周辺", "196": "昭島市", "197": "福生市",
  "198": "青梅市", "199": "あきる野市",
  "200": "東京都島嶼", "201": "狛江市", "202": "西東京市周辺", "203": "東久留米市",
  "204": "清瀬市", "205": "羽村市", "206": "多摩市", "207": "東大和市",
  "208": "武蔵村山市",

  // 神奈川県 210-259
  "210": "川崎市川崎区", "211": "川崎市中原区", "212": "川崎市幸区", "213": "川崎市高津区",
  "214": "川崎市多摩区", "215": "川崎市麻生区", "216": "川崎市宮前区",
  "217": "川崎市周辺", "218": "川崎市北部", "219": "川崎市西部",
  "220": "横浜市西区", "221": "横浜市神奈川区", "222": "横浜市港北区", "223": "横浜市港北区北",
  "224": "横浜市都筑区", "225": "横浜市青葉区", "226": "横浜市緑区", "227": "横浜市青葉区南",
  "228": "相模原市", "229": "相模原市周辺",
  "230": "横浜市鶴見区", "231": "横浜市中区", "232": "横浜市南区", "233": "横浜市港南区",
  "234": "横浜市港南区南", "235": "横浜市磯子区", "236": "横浜市金沢区", "237": "横須賀市",
  "238": "横須賀市南部", "239": "横須賀市北部",
  "240": "横浜市保土ケ谷区", "241": "横浜市旭区", "242": "大和市", "243": "厚木市",
  "244": "横浜市戸塚区", "245": "横浜市泉区", "246": "横浜市瀬谷区", "247": "横浜市栄区",
  "248": "鎌倉市", "249": "逗子市",
  "250": "小田原市", "251": "藤沢市", "252": "相模原市南区", "253": "茅ヶ崎市",
  "254": "平塚市", "255": "中郡", "256": "小田原市周辺", "257": "秦野市",
  "258": "足柄上郡", "259": "足柄下郡",

  // 千葉県 260-299
  "260": "千葉市中央区", "261": "千葉市美浜区", "262": "千葉市花見川区", "263": "千葉市稲毛区",
  "264": "千葉市若葉区", "265": "千葉市緑区", "266": "千葉市緑区南", "267": "千葉市緑区周辺",
  "268": "千葉市緑区東", "269": "千葉市周辺",
  "270": "松戸市", "271": "松戸市周辺", "272": "市川市", "273": "船橋市",
  "274": "船橋市東部", "275": "習志野市", "276": "八千代市", "277": "柏市",
  "278": "野田市", "279": "浦安市",
  "280": "千葉市中央区周辺", "281": "千葉市北部", "282": "成田市周辺", "283": "東金市",
  "284": "四街道市", "285": "佐倉市", "286": "成田市", "287": "香取市",
  "288": "銚子市", "289": "香取郡",
  "290": "市原市", "291": "市原市南部", "292": "木更津市", "293": "富津市",
  "294": "館山市周辺", "295": "南房総市", "296": "鴨川市", "297": "茂原市",
  "298": "いすみ市", "299": "夷隅郡",

  // 茨城県 300-319
  "300": "土浦市", "301": "龍ケ崎市", "302": "取手市", "303": "常総市",
  "304": "下妻市", "305": "つくば市", "306": "古河市", "307": "結城市",
  "308": "筑西市", "309": "笠間市",
  "310": "水戸市", "311": "ひたちなか市", "312": "ひたちなか市周辺", "313": "常陸太田市",
  "314": "鹿嶋市", "315": "石岡市", "316": "日立市", "317": "日立市周辺",
  "318": "高萩市", "319": "北茨城市",

  // 栃木県 320-329
  "320": "宇都宮市", "321": "宇都宮市周辺", "322": "鹿沼市", "323": "栃木市",
  "324": "大田原市", "325": "那須塩原市", "326": "足利市", "327": "佐野市",
  "328": "栃木市周辺", "329": "那須郡",

  // 埼玉県 330-369
  "330": "さいたま市浦和区", "331": "さいたま市北区", "332": "川口市", "333": "川口市北部",
  "334": "川口市南部", "335": "戸田市", "336": "さいたま市南区", "337": "さいたま市見沼区",
  "338": "さいたま市中央区", "339": "さいたま市岩槻区",
  "340": "草加市", "341": "三郷市", "342": "吉川市", "343": "越谷市",
  "344": "春日部市", "345": "北葛飾郡", "346": "久喜市", "347": "加須市",
  "348": "羽生市", "349": "南埼玉郡",
  "350": "川越市", "351": "朝霞市", "352": "新座市", "353": "志木市",
  "354": "富士見市", "355": "東松山市", "356": "ふじみ野市", "357": "飯能市",
  "358": "入間市", "359": "所沢市",
  "360": "熊谷市", "361": "行田市", "362": "上尾市", "363": "桶川市",
  "364": "北本市", "365": "鴻巣市", "366": "深谷市", "367": "本庄市",
  "368": "秩父市", "369": "秩父郡",

  // 群馬県 370-379
  "370": "高崎市", "371": "前橋市", "372": "伊勢崎市", "373": "太田市",
  "374": "館林市", "375": "藤岡市", "376": "桐生市", "377": "渋川市",
  "378": "沼田市", "379": "利根郡",

  // 長野県 380-399
  "380": "長野市", "381": "長野市周辺", "382": "須坂市", "383": "中野市",
  "384": "小諸市", "385": "佐久市", "386": "上田市", "387": "千曲市",
  "388": "長野市南部", "389": "北佐久郡",
  "390": "松本市", "391": "松本市周辺", "392": "諏訪市", "393": "諏訪郡",
  "394": "岡谷市", "395": "飯田市", "396": "伊那市", "397": "木曽郡",
  "398": "大町市", "399": "安曇野市",

  // 山梨県 400-409
  "400": "甲府市", "401": "富士吉田市", "402": "都留市", "403": "富士河口湖町",
  "404": "山梨市", "405": "山梨市周辺", "406": "北杜市", "407": "韮崎市",
  "408": "北杜市周辺", "409": "南巨摩郡",

  // 静岡県 410-439
  "410": "沼津市", "411": "三島市", "412": "御殿場市", "413": "熱海市",
  "414": "伊東市", "415": "下田市", "416": "富士市", "417": "富士市周辺",
  "418": "富士宮市", "419": "富士宮市周辺",
  "420": "静岡市葵区", "421": "静岡市駿河区", "422": "静岡市駿河区南", "423": "静岡市清水区",
  "424": "静岡市清水区南", "425": "焼津市", "426": "藤枝市", "427": "島田市",
  "428": "榛原郡", "429": "榛原郡周辺",
  "430": "浜松市中央区", "431": "浜松市周辺", "432": "浜松市中区", "433": "浜松市北区",
  "434": "浜松市天竜区", "435": "浜松市東区", "436": "掛川市", "437": "袋井市",
  "438": "磐田市", "439": "菊川市",

  // 愛知県 440-498
  "440": "豊橋市", "441": "豊橋市周辺", "442": "豊川市", "443": "蒲郡市",
  "444": "岡崎市", "445": "西尾市", "446": "安城市", "447": "碧南市",
  "448": "刈谷市", "449": "豊田市周辺",
  "450": "名古屋市中村区", "451": "名古屋市西区", "452": "名古屋市西区周辺", "453": "名古屋市中村区南",
  "454": "名古屋市中川区", "455": "名古屋市港区", "456": "名古屋市熱田区", "457": "名古屋市南区",
  "458": "名古屋市緑区", "459": "名古屋市緑区周辺",
  "460": "名古屋市中区", "461": "名古屋市東区", "462": "名古屋市北区", "463": "名古屋市守山区",
  "464": "名古屋市千種区", "465": "名古屋市名東区", "466": "名古屋市昭和区", "467": "名古屋市瑞穂区",
  "468": "名古屋市天白区", "469": "名古屋市周辺",
  "470": "豊田市", "471": "豊田市南部", "472": "知立市", "473": "豊田市東部",
  "474": "大府市", "475": "半田市", "476": "東海市", "477": "東海市周辺",
  "478": "知多市", "479": "常滑市",
  "480": "丹羽郡", "481": "北名古屋市", "482": "岩倉市", "483": "江南市",
  "484": "犬山市", "485": "小牧市", "486": "春日井市", "487": "春日井市周辺",
  "488": "尾張旭市", "489": "瀬戸市",
  "490": "海部郡", "491": "一宮市", "492": "稲沢市", "493": "あま市",
  "494": "愛西市", "495": "稲沢市周辺", "496": "津島市", "497": "海部郡周辺",
  "498": "弥富市",

  // 岐阜県 500-509
  "500": "岐阜市", "501": "岐阜市周辺", "502": "岐阜市北部", "503": "大垣市",
  "504": "各務原市", "505": "美濃加茂市", "506": "高山市", "507": "多治見市",
  "508": "中津川市", "509": "可児市",

  // 三重県 510-519
  "510": "四日市市", "511": "桑名市", "512": "四日市市北部", "513": "鈴鹿市",
  "514": "津市", "515": "松阪市", "516": "伊勢市", "517": "鳥羽市",
  "518": "名張市", "519": "伊賀市",

  // 滋賀県 520-529
  "520": "大津市", "521": "米原市", "522": "彦根市", "523": "近江八幡市",
  "524": "守山市", "525": "草津市", "526": "長浜市", "527": "東近江市",
  "528": "甲賀市", "529": "長浜市周辺",

  // 大阪府 530-599
  "530": "大阪市北区", "531": "大阪市北区周辺", "532": "大阪市淀川区", "533": "大阪市東淀川区",
  "534": "大阪市都島区", "535": "大阪市旭区", "536": "大阪市城東区", "537": "大阪市東成区",
  "538": "大阪市鶴見区", "539": "大阪市東成区周辺",
  "540": "大阪市中央区", "541": "大阪市中央区東", "542": "大阪市中央区南", "543": "大阪市天王寺区",
  "544": "大阪市生野区", "545": "大阪市阿倍野区", "546": "大阪市東住吉区", "547": "大阪市平野区",
  "548": "大阪市平野区周辺", "549": "大阪市周辺",
  "550": "大阪市西区", "551": "大阪市大正区", "552": "大阪市港区", "553": "大阪市福島区",
  "554": "大阪市此花区", "555": "大阪市西淀川区", "556": "大阪市浪速区", "557": "大阪市西成区",
  "558": "大阪市住吉区", "559": "大阪市住之江区",
  "560": "豊中市", "561": "豊中市周辺", "562": "箕面市", "563": "池田市",
  "564": "吹田市", "565": "吹田市周辺", "566": "摂津市", "567": "茨木市",
  "568": "茨木市周辺", "569": "高槻市",
  "570": "守口市", "571": "門真市", "572": "寝屋川市", "573": "枚方市",
  "574": "大東市", "575": "四條畷市", "576": "交野市", "577": "東大阪市",
  "578": "東大阪市周辺", "579": "東大阪市南部",
  "580": "松原市", "581": "八尾市", "582": "柏原市", "583": "藤井寺市",
  "584": "富田林市", "585": "南河内郡", "586": "河内長野市", "587": "堺市東区",
  "588": "堺市南区", "589": "大阪狭山市",
  "590": "堺市堺区", "591": "堺市北区", "592": "堺市西区", "593": "堺市周辺",
  "594": "和泉市", "595": "泉大津市", "596": "岸和田市", "597": "貝塚市",
  "598": "泉佐野市", "599": "泉南市",

  // 京都府 600-629
  "600": "京都市下京区", "601": "京都市南区", "602": "京都市上京区", "603": "京都市北区",
  "604": "京都市中京区", "605": "京都市東山区", "606": "京都市左京区", "607": "京都市山科区",
  "608": "京都市南区周辺", "609": "京都市西京区",
  "610": "京都市伏見区", "611": "宇治市", "612": "京都市伏見区南", "613": "京都市伏見区東",
  "614": "八幡市", "615": "京都市右京区", "616": "京都市右京区北", "617": "向日市",
  "618": "大山崎町", "619": "木津川市",
  "620": "福知山市", "621": "亀岡市", "622": "南丹市", "623": "綾部市",
  "624": "舞鶴市", "625": "舞鶴市周辺", "626": "宮津市", "627": "京丹後市",
  "628": "京丹後市周辺", "629": "船井郡",

  // 奈良県 630-639
  "630": "奈良市", "631": "奈良市西部", "632": "天理市", "633": "桜井市",
  "634": "橿原市", "635": "大和高田市", "636": "北葛城郡", "637": "五條市",
  "638": "吉野郡", "639": "香芝市",

  // 和歌山県 640-649
  "640": "和歌山市", "641": "和歌山市南部", "642": "海南市", "643": "有田市",
  "644": "日高郡", "645": "田辺市", "646": "田辺市周辺", "647": "新宮市",
  "648": "新宮市周辺", "649": "有田郡",

  // 兵庫県 650-679
  "650": "神戸市中央区", "651": "神戸市中央区周辺", "652": "神戸市兵庫区", "653": "神戸市長田区",
  "654": "神戸市須磨区", "655": "神戸市垂水区", "656": "洲本市", "657": "神戸市灘区",
  "658": "神戸市東灘区", "659": "芦屋市",
  "660": "尼崎市", "661": "尼崎市北部", "662": "西宮市", "663": "西宮市南部",
  "664": "伊丹市", "665": "宝塚市", "666": "川西市", "667": "養父市",
  "668": "豊岡市", "669": "丹波篠山市",
  "670": "姫路市", "671": "姫路市周辺", "672": "姫路市南部", "673": "明石市",
  "674": "明石市周辺", "675": "加古川市", "676": "高砂市", "677": "西脇市",
  "678": "相生市", "679": "たつの市",

  // 鳥取県 680-689
  "680": "鳥取市", "681": "鳥取市周辺", "682": "倉吉市", "683": "米子市",
  "684": "境港市", "685": "日野郡", "686": "日野郡周辺", "687": "八頭郡",
  "688": "八頭郡周辺", "689": "東伯郡",

  // 島根県 690-699
  "690": "松江市", "691": "松江市周辺", "692": "安来市", "693": "出雲市",
  "694": "大田市", "695": "江津市", "696": "邑智郡", "697": "浜田市",
  "698": "益田市", "699": "仁多郡",

  // 岡山県 700-719
  "700": "岡山市北区", "701": "岡山市南区", "702": "岡山市東区", "703": "岡山市中区",
  "704": "岡山市東区周辺", "705": "備前市", "706": "玉野市", "707": "美作市",
  "708": "津山市", "709": "赤磐市",
  "710": "倉敷市", "711": "倉敷市周辺", "712": "倉敷市水島", "713": "倉敷市南部",
  "714": "笠岡市", "715": "井原市", "716": "高梁市", "717": "新見市",
  "718": "新見市周辺", "719": "総社市",

  // 広島県 720-739
  "720": "福山市", "721": "福山市周辺", "722": "尾道市", "723": "三原市",
  "724": "竹原市", "725": "竹原市周辺", "726": "府中市", "727": "庄原市",
  "728": "三次市", "729": "神石郡",
  "730": "広島市中区", "731": "広島市安佐南区", "732": "広島市東区", "733": "広島市西区",
  "734": "広島市南区", "735": "安芸郡", "736": "安芸郡周辺", "737": "呉市",
  "738": "廿日市市", "739": "東広島市",

  // 山口県 740-759
  "740": "岩国市", "741": "岩国市周辺", "742": "柳井市", "743": "光市",
  "744": "下松市", "745": "周南市", "746": "周南市周辺", "747": "防府市",
  "748": "防府市周辺", "749": "防府市南部",
  "750": "下関市", "751": "下関市周辺", "752": "下関市南部", "753": "山口市",
  "754": "山口市周辺", "755": "宇部市", "756": "山陽小野田市", "757": "山口市南部",
  "758": "萩市", "759": "長門市",

  // 香川県 760-769
  "760": "高松市", "761": "高松市周辺", "762": "坂出市", "763": "丸亀市",
  "764": "仲多度郡", "765": "善通寺市", "766": "三豊市", "767": "三豊市周辺",
  "768": "観音寺市", "769": "観音寺市周辺",

  // 徳島県 770-779
  "770": "徳島市", "771": "徳島市周辺", "772": "鳴門市", "773": "小松島市",
  "774": "阿南市", "775": "阿波市", "776": "吉野川市", "777": "美馬市",
  "778": "三好市", "779": "三好郡",

  // 高知県 780-789
  "780": "高知市", "781": "高知市周辺", "782": "香美市", "783": "南国市",
  "784": "安芸市", "785": "須崎市", "786": "高岡郡", "787": "四万十市",
  "788": "宿毛市", "789": "長岡郡",

  // 愛媛県 790-799
  "790": "松山市", "791": "松山市周辺", "792": "新居浜市", "793": "西条市",
  "794": "今治市", "795": "大洲市", "796": "八幡浜市", "797": "西予市",
  "798": "宇和島市", "799": "四国中央市",

  // 福岡県 800-839
  "800": "北九州市門司区", "801": "北九州市門司区周辺", "802": "北九州市小倉北区", "803": "北九州市小倉北区周辺",
  "804": "北九州市戸畑区", "805": "北九州市八幡東区", "806": "北九州市八幡西区", "807": "北九州市八幡西区周辺",
  "808": "北九州市若松区", "809": "中間市",
  "810": "福岡市中央区", "811": "福岡市東区", "812": "福岡市博多区", "813": "福岡市東区周辺",
  "814": "福岡市早良区", "815": "福岡市南区", "816": "春日市", "817": "対馬市",
  "818": "筑紫野市", "819": "福岡市西区",
  "820": "飯塚市", "821": "嘉穂郡", "822": "直方市", "823": "宮若市",
  "824": "行橋市", "825": "田川市", "826": "田川郡", "827": "田川郡周辺",
  "828": "豊前市", "829": "田川郡南部",
  "830": "久留米市", "831": "久留米市周辺", "832": "柳川市", "833": "筑後市",
  "834": "八女市", "835": "みやま市", "836": "大牟田市", "837": "大牟田市周辺",
  "838": "朝倉市", "839": "うきは市",

  // 佐賀県 840-849
  "840": "佐賀市", "841": "鳥栖市", "842": "神埼市", "843": "唐津市",
  "844": "西松浦郡", "845": "小城市", "846": "多久市", "847": "唐津市周辺",
  "848": "伊万里市", "849": "鹿島市",

  // 長崎県 850-859
  "850": "長崎市", "851": "長崎市周辺", "852": "長崎市北部", "853": "五島市",
  "854": "諫早市", "855": "島原市", "856": "大村市", "857": "佐世保市",
  "858": "佐世保市周辺", "859": "東彼杵郡",

  // 熊本県 860-869
  "860": "熊本市中央区", "861": "熊本市周辺", "862": "熊本市南区", "863": "天草市",
  "864": "荒尾市", "865": "玉名市", "866": "八代市", "867": "人吉市",
  "868": "球磨郡", "869": "宇土市",

  // 大分県 870-879
  "870": "大分市", "871": "中津市", "872": "宇佐市", "873": "杵築市",
  "874": "別府市", "875": "臼杵市", "876": "佐伯市", "877": "日田市",
  "878": "竹田市", "879": "由布市",

  // 宮崎県 880-889
  "880": "宮崎市", "881": "西都市", "882": "延岡市", "883": "日向市",
  "884": "児湯郡", "885": "都城市", "886": "小林市", "887": "日南市",
  "888": "串間市", "889": "宮崎郡",

  // 鹿児島県 890-899
  "890": "鹿児島市", "891": "鹿児島市周辺", "892": "鹿児島市中央", "893": "鹿屋市",
  "894": "奄美市", "895": "薩摩川内市", "896": "いちき串木野市", "897": "南さつま市",
  "898": "枕崎市", "899": "霧島市",

  // 沖縄県 900-907
  "900": "那覇市", "901": "那覇市周辺", "902": "那覇市東部", "903": "名護市",
  "904": "沖縄市", "905": "名護市周辺", "906": "宮古島市", "907": "石垣市",

  // 福島県 960-979
  "960": "福島市", "961": "白河市", "962": "須賀川市", "963": "郡山市",
  "964": "二本松市", "965": "会津若松市", "966": "南会津郡", "967": "南会津郡周辺",
  "968": "大沼郡", "969": "耶麻郡",
  "970": "いわき市", "971": "いわき市周辺", "972": "いわき市南部", "973": "いわき市東部",
  "974": "いわき市北部", "975": "いわき市西部", "976": "相馬市", "977": "相馬郡",
  "978": "双葉郡", "979": "双葉郡周辺",

  // 宮城県 980-989
  "980": "仙台市青葉区", "981": "仙台市青葉区周辺", "982": "仙台市太白区", "983": "仙台市宮城野区",
  "984": "仙台市若林区", "985": "塩竈市", "986": "石巻市", "987": "登米市",
  "988": "気仙沼市", "989": "白石市",

  // 山形県 990-999
  "990": "山形市", "991": "寒河江市", "992": "米沢市", "993": "長井市",
  "994": "天童市", "995": "村山市", "996": "新庄市", "997": "鶴岡市",
  "998": "酒田市", "999": "最上郡",

  // 新潟県 940-959
  "940": "長岡市", "941": "糸魚川市周辺", "942": "十日町市", "943": "小千谷市",
  "944": "妙高市", "945": "柏崎市", "946": "魚沼市", "947": "小千谷市周辺",
  "948": "十日町市周辺", "949": "南魚沼市",
  "950": "新潟市中央区", "951": "新潟市中央区周辺", "952": "佐渡市", "953": "新潟市西蒲区",
  "954": "見附市", "955": "三条市", "956": "新潟市秋葉区", "957": "新発田市",
  "958": "村上市", "959": "燕市",

  // 富山県 930-939
  "930": "富山市", "931": "富山市周辺", "932": "小矢部市", "933": "高岡市",
  "934": "射水市", "935": "氷見市", "936": "滑川市", "937": "魚津市",
  "938": "黒部市", "939": "南砺市",

  // 石川県 920-929
  "920": "金沢市", "921": "金沢市南部", "922": "加賀市", "923": "小松市",
  "924": "白山市", "925": "羽咋市", "926": "七尾市", "927": "珠洲市",
  "928": "輪島市周辺", "929": "かほく市",

  // 福井県 910-919
  "910": "福井市", "911": "勝山市", "912": "大野市", "913": "坂井市周辺",
  "914": "敦賀市", "915": "越前市", "916": "鯖江市", "917": "小浜市",
  "918": "福井市周辺", "919": "坂井市",
};

// ---------------------------------------------------------------------------
// 3. Prefecture border adjacencies (prefecture code pairs that share borders)
// ---------------------------------------------------------------------------

const PREFECTURE_BORDERS = [
  // 北海道 is isolated (no land border with Tohoku, but we link closest postal areas)
  // 青森-岩手
  ["02", "03"],
  // 青森-秋田
  ["02", "05"],
  // 岩手-秋田
  ["03", "05"],
  // 岩手-宮城
  ["03", "04"],
  // 秋田-山形
  ["05", "06"],
  // 宮城-山形
  ["04", "06"],
  // 宮城-福島
  ["04", "07"],
  // 山形-福島
  ["06", "07"],
  // 山形-新潟
  ["06", "15"],
  // 福島-茨城
  ["07", "08"],
  // 福島-栃木
  ["07", "09"],
  // 福島-群馬
  ["07", "10"],
  // 福島-新潟
  ["07", "15"],
  // 茨城-栃木
  ["08", "09"],
  // 茨城-千葉
  ["08", "12"],
  // 茨城-埼玉
  ["08", "11"],
  // 栃木-群馬
  ["09", "10"],
  // 栃木-埼玉
  ["09", "11"],
  // 群馬-埼玉
  ["10", "11"],
  // 群馬-長野
  ["10", "20"],
  // 群馬-新潟
  ["10", "15"],
  // 埼玉-千葉
  ["11", "12"],
  // 埼玉-東京
  ["11", "13"],
  // 千葉-東京
  ["12", "13"],
  // 東京-神奈川
  ["13", "14"],
  // 東京-山梨
  ["13", "19"],
  // 神奈川-山梨
  ["14", "19"],
  // 神奈川-静岡
  ["14", "22"],
  // 埼玉-山梨
  ["11", "19"],
  // 山梨-長野
  ["19", "20"],
  // 山梨-静岡
  ["19", "22"],
  // 長野-新潟
  ["20", "15"],
  // 長野-静岡
  ["20", "22"],
  // 長野-愛知
  ["20", "23"],
  // 長野-岐阜
  ["20", "21"],
  // 長野-富山
  ["20", "16"],
  // 新潟-富山
  ["15", "16"],
  // 富山-石川
  ["16", "17"],
  // 富山-岐阜
  ["16", "21"],
  // 石川-福井
  ["17", "18"],
  // 石川-岐阜
  ["17", "21"],
  // 福井-岐阜
  ["18", "21"],
  // 福井-滋賀
  ["18", "25"],
  // 福井-京都
  ["18", "26"],
  // 静岡-愛知
  ["22", "23"],
  // 愛知-岐阜
  ["23", "21"],
  // 愛知-三重
  ["23", "24"],
  // 岐阜-三重
  ["21", "24"],
  // 岐阜-滋賀
  ["21", "25"],
  // 三重-滋賀
  ["24", "25"],
  // 三重-京都
  ["24", "26"],
  // 三重-奈良
  ["24", "29"],
  // 三重-和歌山
  ["24", "30"],
  // 三重-大阪
  ["24", "27"],
  // 滋賀-京都
  ["25", "26"],
  // 滋賀-大阪
  ["25", "27"],
  // 京都-大阪
  ["26", "27"],
  // 京都-兵庫
  ["26", "28"],
  // 京都-奈良
  ["26", "29"],
  // 大阪-兵庫
  ["27", "28"],
  // 大阪-奈良
  ["27", "29"],
  // 大阪-和歌山
  ["27", "30"],
  // 兵庫-鳥取
  ["28", "31"],
  // 兵庫-岡山
  ["28", "33"],
  // 奈良-和歌山
  ["29", "30"],
  // 鳥取-島根
  ["31", "32"],
  // 鳥取-岡山
  ["31", "33"],
  // 鳥取-広島
  ["31", "34"],
  // 島根-広島
  ["32", "34"],
  // 島根-山口
  ["32", "35"],
  // 岡山-広島
  ["33", "34"],
  // 広島-山口
  ["34", "35"],
  // 広島-愛媛  (しまなみ海道)
  ["34", "38"],
  // 山口-福岡 (関門)
  ["35", "40"],
  // 山口-大分  (周防灘フェリー隣接)
  ["35", "44"],
  // 徳島-香川
  ["36", "37"],
  // 徳島-愛媛
  ["36", "38"],
  // 徳島-高知
  ["36", "39"],
  // 香川-愛媛
  ["37", "38"],
  // 愛媛-高知
  ["38", "39"],
  // 香川-岡山 (瀬戸大橋)
  ["37", "33"],
  // 兵庫-徳島 (淡路島)
  ["28", "36"],
  // 福岡-佐賀
  ["40", "41"],
  // 福岡-大分
  ["40", "44"],
  // 福岡-熊本
  ["40", "43"],
  // 佐賀-長崎
  ["41", "42"],
  // 佐賀-熊本 (有明海)
  ["41", "43"],
  // 長崎-熊本 (島原半島フェリー)
  ["42", "43"],
  // 熊本-大分
  ["43", "44"],
  // 熊本-宮崎
  ["43", "45"],
  // 熊本-鹿児島
  ["43", "46"],
  // 大分-宮崎
  ["44", "45"],
  // 宮崎-鹿児島
  ["45", "46"],
  // 鹿児島-沖縄 (ferry/air link for game connectivity)
  ["46", "47"],
];

// ---------------------------------------------------------------------------
// 4. Helper: pad a number to 3-digit string
// ---------------------------------------------------------------------------

function pad3(n) {
  return String(n).padStart(3, "0");
}

// ---------------------------------------------------------------------------
// 5. Build data structures
// ---------------------------------------------------------------------------

function generate() {
  // --- Build postal prefix → prefecture lookup ---
  const prefixToPrefecture = {};  // "100" → prefectureObj

  for (const pref of PREFECTURES) {
    for (const [lo, hi] of pref.ranges) {
      for (let n = lo; n <= hi; n++) {
        prefixToPrefecture[pad3(n)] = pref;
      }
    }
  }

  const allPrefixes = Object.keys(prefixToPrefecture).sort();

  // --- prefectures.json ---
  const prefecturesJson = PREFECTURES.map((pref) => {
    const postalPrefixes = [];
    for (const [lo, hi] of pref.ranges) {
      for (let n = lo; n <= hi; n++) {
        postalPrefixes.push(pad3(n));
      }
    }
    postalPrefixes.sort();
    return {
      code: pref.code,
      name: pref.name,
      nameEn: pref.nameEn,
      region: pref.region,
      element: pref.element,
      postalPrefixes,
      population: pref.population,
    };
  });

  // --- districts.json ---
  const districtsJson = {};
  for (const prefix of allPrefixes) {
    const pref = prefixToPrefecture[prefix];
    const name = DISTRICT_NAMES[prefix] || `${pref.name}地域`;
    districtsJson[prefix] = {
      prefecture: pref.name,
      prefectureCode: pref.code,
      name,
      element: pref.element,
    };
  }

  // --- adjacency.json ---
  // Build prefecture code → sorted list of postal prefixes
  const prefCodeToPrefixes = {};
  for (const pref of PREFECTURES) {
    const prefixes = [];
    for (const [lo, hi] of pref.ranges) {
      for (let n = lo; n <= hi; n++) {
        prefixes.push(pad3(n));
      }
    }
    prefixes.sort();
    prefCodeToPrefixes[pref.code] = prefixes;
  }

  // Initialize adjacency as Sets
  const adjacency = {};
  for (const prefix of allPrefixes) {
    adjacency[prefix] = new Set();
  }

  // Rule 1: Sequential codes within the same prefecture are adjacent
  for (const pref of PREFECTURES) {
    const prefixes = prefCodeToPrefixes[pref.code];
    for (let i = 0; i < prefixes.length; i++) {
      const current = prefixes[i];
      const currentNum = parseInt(current, 10);
      // Check if the next sequential number belongs to the same prefecture
      const nextCode = pad3(currentNum + 1);
      if (prefixToPrefecture[nextCode] && prefixToPrefecture[nextCode].code === pref.code) {
        adjacency[current].add(nextCode);
        adjacency[nextCode].add(current);
      }
    }
  }

  // Rule 2: Border districts of adjacent prefectures
  for (const [codeA, codeB] of PREFECTURE_BORDERS) {
    const prefixesA = prefCodeToPrefixes[codeA];
    const prefixesB = prefCodeToPrefixes[codeB];
    if (!prefixesA || !prefixesB) continue;

    // Find the border districts: last of A ↔ first of B, and first of A ↔ last of B
    // We connect the "closest" ends. To determine which ends are closest,
    // we compare the numeric values.
    const firstA = prefixesA[0];
    const lastA = prefixesA[prefixesA.length - 1];
    const firstB = prefixesB[0];
    const lastB = prefixesB[prefixesB.length - 1];

    // Connect all four combinations and pick the closest pair(s)
    const pairs = [
      [lastA, firstB, Math.abs(parseInt(lastA) - parseInt(firstB))],
      [firstA, lastB, Math.abs(parseInt(firstA) - parseInt(lastB))],
      [firstA, firstB, Math.abs(parseInt(firstA) - parseInt(firstB))],
      [lastA, lastB, Math.abs(parseInt(lastA) - parseInt(lastB))],
    ];

    // Sort by distance and pick the closest pair
    pairs.sort((a, b) => a[2] - b[2]);
    const minDist = pairs[0][2];

    // Connect all pairs that share the minimum distance (often just 1)
    for (const [a, b, dist] of pairs) {
      if (dist <= minDist + 50) {
        // Connect the border districts and their immediate neighbors
        adjacency[a].add(b);
        adjacency[b].add(a);
      }
    }
  }

  // Convert Sets to sorted arrays
  const adjacencyJson = {};
  for (const prefix of allPrefixes) {
    adjacencyJson[prefix] = [...adjacency[prefix]].sort();
  }

  return { prefecturesJson, districtsJson, adjacencyJson };
}

// ---------------------------------------------------------------------------
// 6. Write files
// ---------------------------------------------------------------------------

function main() {
  const dataDir = path.join(__dirname, "..", "data");
  if (!fs.existsSync(dataDir)) {
    fs.mkdirSync(dataDir, { recursive: true });
  }

  const { prefecturesJson, districtsJson, adjacencyJson } = generate();

  fs.writeFileSync(
    path.join(dataDir, "prefectures.json"),
    JSON.stringify(prefecturesJson, null, 2) + "\n"
  );
  fs.writeFileSync(
    path.join(dataDir, "districts.json"),
    JSON.stringify(districtsJson, null, 2) + "\n"
  );
  fs.writeFileSync(
    path.join(dataDir, "adjacency.json"),
    JSON.stringify(adjacencyJson, null, 2) + "\n"
  );

  // Summary
  const prefCount = prefecturesJson.length;
  const distCount = Object.keys(districtsJson).length;
  const adjCount = Object.keys(adjacencyJson).length;
  const totalEdges = Object.values(adjacencyJson).reduce((s, arr) => s + arr.length, 0) / 2;

  console.log(`Generated data files in ${dataDir}/`);
  console.log(`  prefectures.json: ${prefCount} prefectures`);
  console.log(`  districts.json:   ${distCount} districts`);
  console.log(`  adjacency.json:   ${adjCount} entries, ${totalEdges} edges`);

  // Validate: every district should have at least 1 adjacency
  let isolated = 0;
  for (const [prefix, adj] of Object.entries(adjacencyJson)) {
    if (adj.length === 0) {
      isolated++;
    }
  }
  if (isolated > 0) {
    console.warn(`  WARNING: ${isolated} districts have no adjacencies`);
  } else {
    console.log(`  All districts have at least 1 adjacency`);
  }

  // Validate: every postal prefix maps to exactly one prefecture
  const prefixSet = new Set();
  for (const pref of prefecturesJson) {
    for (const p of pref.postalPrefixes) {
      if (prefixSet.has(p)) {
        console.error(`  ERROR: duplicate prefix ${p}`);
      }
      prefixSet.add(p);
    }
  }
  console.log(`  Total unique postal prefixes: ${prefixSet.size}`);
}

main();
