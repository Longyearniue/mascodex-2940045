<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>ã»ã†ã˜ã‚‡ã†ã‚Œãƒ¼ã¬ - åŒ—æ¡</title>
  <style>
    body {
      font-family: sans-serif;
      padding: 2rem;
      max-width: 800px;
      margin: auto;
    }
    h1 { font-size: 2rem; }
    .tagline {
      display: inline-block;
      background: #ffdd57;
      color: #000;
      font-weight: bold;
      padding: .2rem .6rem;
      border-radius: 8px;
      margin-top: .4rem;
    }
    .mascots img {
      width: 30%;
      border-radius: 12px;
      margin: 0 1%;
    }
    .section {
      margin-top: 2rem;
    }
    #talk-ui {
      margin-top: 2rem;
      padding: 1rem;
      border: 1px solid #ccc;
      border-radius: 8px;
      background: #f9f9f9;
    }
    #chat-log p {
      margin: 0.5rem 0;
    }
  </style>
</head>
<body>
  <h2>åƒè‘‰çœŒ é¤¨å±±å¸‚ åŒ—æ¡ ã®éå…¬å¼ã‚†ã‚‹ã‚­ãƒ£ãƒ©ãƒšãƒ¼ã‚¸</h2>
  <p class="tagline">å‹æ‰‹ã«ã”å½“åœ°PR</p>

  <h1>ã»ã†ã˜ã‚‡ã†ã‚Œãƒ¼ã¬</h1>
  <p>ã€’2940045ï½œåƒè‘‰çœŒ é¤¨å±±å¸‚ åŒ—æ¡</p>

  <div class="mascots">
    <img src="https://img.mascodex.com/2940045_01.png" alt="ã»ã†ã˜ã‚‡ã†ã‚Œãƒ¼ã¬ 1">
    <img src="https://img.mascodex.com/2940045_02.png" alt="ã»ã†ã˜ã‚‡ã†ã‚Œãƒ¼ã¬ 2">
    <img src="https://img.mascodex.com/2940045_03.png" alt="ã»ã†ã˜ã‚‡ã†ã‚Œãƒ¼ã¬ 3">
  </div>

  <!-- ç´¹ä»‹ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
  <div class="section">
    <h2>ç´¹ä»‹</h2>
    <p>é¤¨å±±æ¹¾ã®ç©ã‚„ã‹ãªæµ·ã®ãã°ã§è‚²ã£ãŸã»ã†ã˜ã‚‡ã†ã‚Œãƒ¼ã¬ã¯ã€é’ã„ä½“ã¨è²æ®»ã®å¸½å­ãŒãƒãƒ£ãƒ¼ãƒ ãƒã‚¤ãƒ³ãƒˆã€‚åœ°å…ƒã®äººãŸã¡ã«ç¬‘é¡”ã¨æ¸©ã‹ã•ã‚’å±Šã‘ãªãŒã‚‰ã€è¦³å…‰å®¢ã«ã‚‚é¤¨å±±ã®é­…åŠ›ã‚’æ•™ãˆã‚‹å„ªã—ã„ã‚Œãƒ¼ã¬ã§ã™ã€‚</p>
  </div>

  <!-- ä¼šè©±ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
  <div id="talk-ui">
    <h2>ã»ã†ã˜ã‚‡ã†ã‚Œãƒ¼ã¬ã¨è©±ãã†ï¼</h2>
    <div id="chat-log" style="min-height: 100px; margin-bottom: 1rem;"></div>
    <input type="text" id="user-input" placeholder="è©±ã—ã‹ã‘ã¦ã­" style="width: 70%;">
    <button onclick="talk()">é€ä¿¡</button>
    <div style="margin-top: 1rem;">
      <label>ãƒ¬ãƒ™ãƒ«ï¼š<span id="level">1</span></label>
      <div style="background:#eee; height:20px; border-radius:10px; overflow:hidden;">
        <div id="xp-bar" style="height:20px; background:#4caf50; width:5%;"></div>
      </div>
    </div>
  </div>

  <!-- ã‚¹ãƒˆãƒ¼ãƒªãƒ¼ -->
  <div class="section">
    <h2>ã‚¹ãƒˆãƒ¼ãƒªãƒ¼</h2>
    <p>é’ã„ä½“ã«è²æ®»ã®å¸½å­</p>
    <p>é¤¨å±±æ¹¾ã®ç©ã‚„ã‹ãªæµ·ã®ãã°ã§è‚²ã£ãŸã»ã†ã˜ã‚‡ã†ã‚Œãƒ¼ã¬ã¯ã€é’ã„ä½“ã¨è²æ®»ã®å¸½å­ãŒãƒãƒ£ãƒ¼ãƒ ãƒã‚¤ãƒ³ãƒˆã€‚æ–°é®®ãªæµ·ã®å¹¸ãŒå¤§å¥½ãã§ã€æ¯æœã€æ³¢ã®éŸ³ã‚’èããªãŒã‚‰ãŠã„ã—ã„è²ã‚„é­šã‚’æ¥½ã—ã¿ã¾ã™ã€‚è¦³å…‰å®¢ã«ã‚‚é¤¨å±±ã®é­…åŠ›ã‚’æ•™ãˆã‚‹å„ªã—ã„ã‚Œãƒ¼ã¬ã§ã™ã€‚</p>
  </div>

  <script>
    // Initialize level data from localStorage
    let currentLevel = parseInt(localStorage.getItem('mascotLevel') || '1');
    let currentXP = parseInt(localStorage.getItem('mascotXP') || '0');
    
    // Level thresholds
    const levelThresholds = [0, 1, 5, 10, 20, 50, 100, 200, 500, 1000];

    const xpBar = document.getElementById("xp-bar");
    const levelSpan = document.getElementById("level");
    const chatLog = document.getElementById("chat-log");

    // Update UI
    function updateLevelDisplay() {
        levelSpan.textContent = currentLevel;
        
        // Calculate progress to next level
        const currentThreshold = levelThresholds[currentLevel - 1] || 0;
        const nextThreshold = levelThresholds[currentLevel] || levelThresholds[levelThresholds.length - 1];
        const progress = Math.min(100, ((currentXP - currentThreshold) / (nextThreshold - currentThreshold)) * 100);
        
        xpBar.style.width = progress + '%';
    }

    async function talk() {
      const input = document.getElementById("user-input").value;
      if (!input) return;

      const userLine = document.createElement("p");
      userLine.innerText = "ã‚ãªãŸ: " + input;
      chatLog.appendChild(userLine);

      // Disable input during request
      const inputField = document.getElementById("user-input");
      const sendButton = document.querySelector("button");
      inputField.disabled = true;
      sendButton.disabled = true;
      sendButton.textContent = "é€ä¿¡ä¸­...";

      try {
        // Send to chat API
        const chatResponse = await fetch('/api/chat', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({ message: input })
        });
        
        const chatData = await chatResponse.json();
        
        const charLine = document.createElement("p");
        charLine.innerText = "ã‚Œãƒ¼ã¬: " + chatData.response;
        chatLog.appendChild(charLine);
        
        // Update level
        const levelResponse = await fetch('/api/level', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({ currentLevel, currentXP })
        });
        
        const levelData = await levelResponse.json();
        currentLevel = levelData.level;
        currentXP = levelData.xp;
        
        // Save to localStorage
        localStorage.setItem('mascotLevel', currentLevel.toString());
        localStorage.setItem('mascotXP', currentXP.toString());
        
        updateLevelDisplay();
        
        if (levelData.leveledUp) {
          const levelUpLine = document.createElement("p");
          levelUpLine.innerText = `ğŸ‰ ãƒ¬ãƒ™ãƒ«ã‚¢ãƒƒãƒ—ï¼ãƒ¬ãƒ™ãƒ«${currentLevel}ã«ãªã£ãŸã‚ˆï¼`;
          levelUpLine.style.color = "#ff6b35";
          levelUpLine.style.fontWeight = "bold";
          chatLog.appendChild(levelUpLine);
        }
        
      } catch (error) {
        console.error('Error:', error);
        const errorLine = document.createElement("p");
        errorLine.innerText = "ã‚Œãƒ¼ã¬: ã”ã‚ã‚“ãªã•ã„ã€ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚ã‚‚ã†ä¸€åº¦è©¦ã—ã¦ãã ã•ã„ã­ã€‚";
        chatLog.appendChild(errorLine);
      } finally {
        inputField.disabled = false;
        sendButton.disabled = false;
        sendButton.textContent = "é€ä¿¡";
        inputField.value = "";
        chatLog.scrollTop = chatLog.scrollHeight;
      }
    }

    // Event listeners
    document.getElementById("user-input").addEventListener('keypress', function(e) {
      if (e.key === 'Enter') {
        talk();
      }
    });

    // Initialize display
    updateLevelDisplay();

    // Add initial greeting
    const greetingLine = document.createElement("p");
    greetingLine.innerText = "ã‚Œãƒ¼ã¬: ã“ã‚“ã«ã¡ã¯ï¼ã»ã†ã˜ã‚‡ã†ã‚Œãƒ¼ã¬ã ã‚ˆï¼é¤¨å±±ã®ã“ã¨ãªã‚‰ä½•ã§ã‚‚èã„ã¦ã­â™ª";
    greetingLine.style.color = "#006600";
    chatLog.appendChild(greetingLine);
  </script>
</body>
</html>
